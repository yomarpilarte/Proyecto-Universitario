@using Viajes.Models.DTO
@model UsuarioDTO

@{
    var esEdicion = ViewBag.EsEdicion ?? false;
}
@Html.ValidationSummary(false, "", new { @class = "text-danger" })

<input type="hidden" asp-for="IdUsuario" />

<div class="row">
    @* Validación general *@
    <div class="col-12">
        <div id="formError" class="text-danger mb-2" style="display:none;"></div>
    </div>

    <div class="col-md-6 mb-3">
        <label class="form-label">Primer Nombre</label>
        <input asp-for="PrimerNombre" class="form-control soloLetras sinEspacios" required minlength="2" maxlength="20"
               pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ]+$" title="Solo letras sin espacios" />
        <div class="invalid-feedback">Solo se permiten letras, sin espacios.</div>
    </div>

    <div class="col-md-6 mb-3">
        <label class="form-label">Segundo Nombre</label>
        <input asp-for="SegundoNombre" class="form-control soloLetras sinEspacios" required minlength="2" maxlength="20"
               pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ]+$" title="Solo letras sin espacios" />
        <div class="invalid-feedback">Solo se permiten letras, sin espacios.</div>
    </div>

    <div class="col-md-6 mb-3">
        <label class="form-label">Primer Apellido</label>
        <input asp-for="PrimerApellido" class="form-control soloLetras sinEspacios" required minlength="2" maxlength="20"
               pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ]+$" title="Solo letras sin espacios" />
        <div class="invalid-feedback">Solo se permiten letras, sin espacios.</div>
    </div>

    <div class="col-md-6 mb-3">
        <label class="form-label">Segundo Apellido</label>
        <input asp-for="SegundoApellido" class="form-control soloLetras sinEspacios" required minlength="2" maxlength="20"
               pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ]+$" title="Solo letras sin espacios" />
        <div class="invalid-feedback">Solo se permiten letras, sin espacios.</div>
    </div>

    <div class="col-md-6 mb-3">
        <label class="form-label">Correo</label>
        <input asp-for="Correo" class="form-control sinEspacios" type="email" required minlength="5" maxlength="50" />
    </div>

    <div class="col-md-6 mb-3">
        <label class="form-label">Cédula</label>
        <input asp-for="Cedula" class="form-control soloNumeros sinEspacios" required minlength="7" maxlength="20"
               pattern="^[0-9\\-]+$" title="Solo números y guiones sin espacios" />
        <div class="invalid-feedback">Solo se permiten números y guiones, sin espacios.</div>
    </div>

    <div class="col-md-6 mb-3">
        <label class="form-label">Teléfono</label>
        <input asp-for="Telefono" class="form-control soloNumeros sinEspacios" required minlength="7" maxlength="20"
               pattern="^[0-9\\-\\+\\(\\)]+$" title="Solo números y símbolos sin espacios" />
        <div class="invalid-feedback">Solo se permiten números y símbolos válidos (+ - ()), sin espacios.</div>
    </div>

    <div class="col-md-6 mb-3">
        <label class="form-label">Dirección</label>
        <input asp-for="Direccion" class="form-control" required minlength="20" maxlength="100"
               pattern="^[\\wÁÉÍÓÚáéíóúÑñ\\s\\.\\,\\-\\#\\/]+$"
               title="Dirección válida, puede incluir espacios" />
    </div>

    @if (!esEdicion)
    {
        <div class="col-md-6 mb-3">
            <label class="form-label">Usuario</label>
            <input asp-for="Usuario" class="form-control sinEspacios" required minlength="6" maxlength="20"
                   pattern="^[A-Za-z0-9_\\-]+$" title="Solo letras, números y guiones bajos sin espacios" />
        </div>
        <div class="col-md-6 mb-3">
            <label class="form-label">Contraseña</label>
            <input asp-for="Contrasena" class="form-control sinEspacios" type="password" required minlength="8" maxlength="20"
                   pattern="^[^\\s]+$" title="Sin espacios" />
        </div>
    }

    <div class="col-md-6 mb-3">
        <label class="form-label">Departamento</label>
        <select asp-for="IdDepartamento" class="form-select" required>
            <option value="">-- Seleccione --</option>
            <option value="6">Operaciones</option>
            <option value="7">Recursos humanos</option>
            <option value="8">Contabilidad y finanzas</option>
            <option value="9">Mantenimiento</option>
            <option value="10">Tecnología y Sistema</option>
            <option value="11">Gerencia general</option>
        </select>
    </div>

    <div class="col-md-6 mb-3">
        <label class="form-label">Rol</label>
        <select asp-for="IdRol" class="form-select" required>
            <option value="">-- Seleccione --</option>
            <option value="1">Administrador</option>
            <option value="2">Supervisor</option>
            <option value="3">Auditor</option>
            <option value="4">Empleado</option>
        </select>
    </div>
</div>

<!-- ✅ Script de validación en tiempo real -->
<script>
    document.addEventListener("DOMContentLoaded", function () {

        // 🔤 Solo letras
        document.querySelectorAll('.soloLetras').forEach(input => {
            input.addEventListener('input', function () {
                const original = this.value;
                this.value = original.replace(/[^A-Za-zÁÉÍÓÚáéíóúÑñ]/g, '');
                const mensaje = this.nextElementSibling;
                if (original !== this.value) {
                    this.classList.add('is-invalid');
                    mensaje.style.display = 'block';
                } else {
                    this.classList.remove('is-invalid');
                    mensaje.style.display = 'none';
                }
            });
        });

        // 🔢 Solo números y símbolos válidos
        document.querySelectorAll('.soloNumeros').forEach(input => {
            input.addEventListener('input', function () {
                const original = this.value;
                this.value = original.replace(/[^0-9\-+()]/g, '');
                const mensaje = this.nextElementSibling;
                if (original !== this.value) {
                    this.classList.add('is-invalid');
                    mensaje.style.display = 'block';
                } else {
                    this.classList.remove('is-invalid');
                    mensaje.style.display = 'none';
                }
            });
        });

        // 🚫 Bloquear espacios excepto en Dirección
        document.querySelectorAll('.sinEspacios').forEach(input => {
            input.addEventListener('keydown', function (e) {
                if (e.key === " ") {
                    e.preventDefault();
                }
            });
        });
    });
</script>

<style>
    /* 🔴 Estilo visual de error (usando clases de Bootstrap) */
    .is-invalid {
        border-color: #dc3545 !important;
        box-shadow: 0 0 5px rgba(220, 53, 69, 0.5);
    }

    .invalid-feedback {
        color: #dc3545;
        font-size: 0.9rem;
        display: none;
    }
</style>

