@model List<Viajes.Models.DTO.UsuarioDetalleDTO>

@{
    // Lista de opciones de estado
    var opcionesEstado = new List<(string Texto, string Valor)>
    {
        ("Todos", ""),
        ("Activo", "1"),
        ("Inactivo", "0")
    };

    int estadoSeleccionado = ViewBag.Estado != null ? (int)ViewBag.Estado : -1;
}

<h2>Reporte de Usuarios</h2>

<!-- FORMULARIO DE FILTRO -->
<form method="post" asp-action="Reportes">
    <div class="row">

        <div class="col-md-3">
            <label>Fecha Inicio</label>
            <input type="date" name="fechaInicio" class="form-control "  max="@DateTime.Now.ToString("yyyy-MM-dd")" min="@($"{ViewBag.AnoMin}-01-01")"/>
        </div>

        <div class="col-md-3">
            <label>Fecha Fin</label>
            <input type="date" name="fechaFin" class="form-control" max="@DateTime.Now.ToString("yyyy-MM-dd")" min="@($"{ViewBag.AnoMin}-01-01")" />
        </div>

        <div class="col-md-3">
            <label>Estado</label>
            <select class="form-control" name="estado">
                @foreach (var opcion in opcionesEstado)
                {
                    var isSelected = (opcion.Valor == "" && estadoSeleccionado == -1) ||
                    (opcion.Valor == "1" && estadoSeleccionado == 1) ||
                    (opcion.Valor == "0" && estadoSeleccionado == 0);

                    <option value="@opcion.Valor" selected="@(isSelected ? "selected" : null)">
                        @opcion.Texto
                    </option>
                }
            </select>
        </div>

        <div class="col-md-3 mt-4">
            <button type="submit" class="btn btn-primary">Filtrar</button>
        </div>

    </div>
</form>

<hr />
<!-- BOTÓN EXPORTAR PDF -->
<form method="post" asp-action="ExportarPDF">
    <input type="hidden" name="fechaInicio" value="@ViewBag.FechaInicio" />
    <input type="hidden" name="fechaFin" value="@ViewBag.FechaFin" />
    <input type="hidden" name="estado" value="@ViewBag.Estado" />

    <button type="submit" class="btn btn-danger mb-3">Exportar a PDF</button>
</form>

<!-- TABLA DE RESULTADOS -->
<table class="table table-striped">
    <thead>
        <tr>
            <th>Nombres</th>
            <th>Apellidos</th>
            <th>Cédula</th>
            <th>Correo</th>
            <th>Teléfono</th>
            <th>Dirección</th>
            <th>Departamento</th>
            <th>Rol</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var u in Model)
        {
            <tr>
                <td>@u.PrimerNombre @u.SegundoNombre</td>
                <td>@u.PrimerApellido @u.SegundoApellido</td>
                <td>@u.Cedula</td>
                <td>@u.Correo</td>
                <td>@u.Telefono</td>
                <td>@u.Direccion</td>
                <td>@u.Departamento</td>
                <td>@u.Rol</td>
            </tr>
        }
    </tbody>
</table>


@section Scripts {
    <script>
        window.onload = function () {
            var error = '@ViewBag.Error';
            if (error) {
                alert("⚠️ " + error);
            }
        };
    </script>
 
      
     
    


}


